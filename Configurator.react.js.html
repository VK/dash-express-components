<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      Configurator.react.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><ul><li class="menu-li"><a href='https://github.com/VK/dash-express-components' class=' menu-link' id='' target='_blank'>Github</a></li></ul><div class="accordion collapsed" id="3381928" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="ConfigReceiver.html">ConfigReceiver</a></li><li class="accordion-list" id=""><a href="Configurator.html">Configurator</a></li><li class="accordion-list" id=""><a href="Filter.html">Filter</a></li><li class="accordion-list" id=""><a href="Graph.html">Graph</a></li><li class="accordion-list" id=""><a href="MetaCheck.html">MetaCheck</a></li><li class="accordion-list" id=""><a href="Plotter.html">Plotter</a></li><li class="accordion-list" id=""><a href="Transform.html">Transform</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        Configurator.react.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Component } from 'react';

import Accordion from 'react-bootstrap/Accordion';
import Modal from 'react-bootstrap/Modal';
import Button from 'react-bootstrap/Button';
import ButtonGroup from 'react-bootstrap/ButtonGroup';
import classNames from 'classnames';


import Filter from './Filter.react';
import Transform from './Transform.react';
import MetaCheck from './MetaCheck.react';
import Plotter from './Plotter.react';
import Parameterize from './Parameterize.react';
import Localstore from './Localstore.react';
import { none } from 'ramda';

import PropTypes from 'prop-types';



/**
 * Warp all subcomponents used in the configurator into an accordion
 * 
 * @private
 */
class CustomAccordionItem extends Component {
    constructor(props) {
        super(props);

        this.state = {
            isOpen: ("defaultOpen" in props)
        }


    }

    render() {
        const { isOpen } = this.state;

        return (
            &lt;div className='accordion-item'>
                &lt;h2 className='accordion-header'>
                    &lt;button
                        type="button"
                        className={classNames('accordion-button', !isOpen &amp;&amp; 'collapsed')}
                        onClick={e => { this.setState({ isOpen: !isOpen }); }}
                    >
                        {this.props.title}
                    &lt;/button>
                &lt;/h2>
                &lt;div className={classNames('accordion-collapse', !isOpen &amp;&amp; 'collapse')}>
                    &lt;div className='accordion-body'>
                        {this.props.children}
                    &lt;/div>
                &lt;/div>
            &lt;/div>
        )
    }
}


/**
 * &lt;div style="width:450px; margin-left: 20px; float: right;  margin-top: -150px;">
 * &lt;img src="https://raw.githubusercontent.com/VK/dash-express-components/main/.media/configurator.png"/>
 * &lt;/div>
 * 
 *
 * The configurator component helps to define plot definitions based on the
 * metadata of a dataframe.
 * Different configuration parts like `Filter`, `Transform` or `Plotter`
 * are combined in a single accordion component.
 *
 * The metadata is used to compute the available parameters after data 
 * transformations and newly available colums are adjusted automatically.
 * 
 * @hideconstructor
 * 
 * @example
 * import dash_express_components as dxc
 * import plotly.express as px
 * 
 * meta = dxc.get_meta(px.data.gapminder())
 * 
 *  dxc.Configurator(
 *           id="plotConfig",
 *           meta=meta,
 *  )
 * @public
 */
class Configurator extends Component {
    constructor(props) {
        super(props);

        this.state = {
            id: props.id,
            config: props.config,
            meta: props.meta,
            filter_meta_out: { ...props.meta },
            transform_meta_out: { ...props.meta },

            /* state of the modal to ask if edit should be opened */
            showEditModal: false,
            eventConfig: {},
            eventThumbnail: "",
            eventGraphId: "",
            modal_close_timeout: undefined

        };

        this.state.config = this.fix_config(this.state.config);

        this.state.config_filter = this.state.config.filter;
        this.state.config_transform = this.state.config.transform;
        this.state.config_plot = this.state.config.plot;

        window.addEventListener("message", (event) => {

            if ("data" in event &amp;&amp; "configuratorId" in event.data &amp;&amp; event.data.configuratorId == this.props.id) {

                this.setState({
                    showEditModal: true,
                    eventConfig: this.fix_config(event.data.defs),
                    eventThumbnail: event.data.thumbnail,
                    eventGraphId: event.data.graphId
                });

                let that = this;
                let modal_close_timeout = setTimeout(function () { that.handleClose(); }, 5000);

                this.setState({ modal_close_timeout: modal_close_timeout });

            }

        }, false);


        this.filter_ref = React.createRef();
        this.transform_ref = React.createRef();
    }


    fix_config(new_config) {
        if (new_config == undefined) {
            new_config = {};
        }
        if (!("filter" in new_config)) {
            new_config["filter"] = [];
        }
        if (!("transform" in new_config)) {
            new_config["transform"] = [];
        }
        if (!("plot" in new_config)) {
            new_config["plot"] = {};
        }
        if (!("parameterization" in new_config)) {
            new_config["parameterization"] = {
                parameters: [],
                computeAll: false,
                computeMatrix: []
            };
        }
        return new_config;
    }

    update_sub_config(config_dict) {

        let that = this;

        setTimeout(function () {

            let new_config = { ...that.state.config, ...config_dict };

            ["filter", "transform", "plot"].forEach(el => {
                if (el in config_dict) {
                    that.setState({ ['config_' + el]: config_dict[el] },
                        () => { that.update_config(new_config); }
                    )
                }
            })
        }, 50);
    }


    update_config(new_config) {


        new_config = this.fix_config(new_config);

        this.setState({ config_filter: new_config.filter },
            () => {
                this.setState({ config_transform: new_config.transform },
                    () => {
                        this.setState({ config_plot: new_config.plot },
                            () => {
                                this.setState({ config: new_config });
                            })
                    }
                )
            });

        try {
            this.props.setProps({
                currentConfig: new_config
            });
        } catch (e) { };

    }


    update_meta(new_meta) {

        let that = this;

        this.setState({ meta: new_meta },
            () => {

                let filter_meta_out = (that.filter_ref &amp;&amp; that.filter_ref.current) ? that.filter_ref.current.update_config(that.state.config_filter) : new_meta;

                this.setState({ filter_meta_out: filter_meta_out },
                    () => {

                        let transform_meta_out = (that.transform_ref &amp;&amp; that.transform_ref.current) ? that.transform_ref.current.update_config(that.state.config_transform) : filter_meta_out;
                        this.setState({ transform_meta_out: transform_meta_out });

                    }
                )
            });

    }

    update_props(graphId = null) {
        let config = JSON.parse(JSON.stringify(this.state.config));

        config["graphId"] = graphId;

        if (config.filter == null || config.filter === undefined || config.filter.length === 0) {
            delete config["filter"];
        }

        if (config.transform == null || config.transform === undefined || config.transform.length === 0) {
            delete config["transform"];
        }

        if (config.parameterization == null || config.parameterization === undefined || config.parameterization.parameters === undefined
            || config.parameterization.parameters.length === 0) {
            delete config["parameterization"];
        }

        if (config.graphId === null || config.graphId === undefined) {
            delete config["graphId"];
        }

        if (config.plot != null &amp;&amp; config.plot.prevent_update != null) {
            delete config["plot"]["prevent_update"];
        }

        this.props.setProps({
            config: JSON.parse(JSON.stringify(config))
        });
    }


    /**
     * external parameters like the dataframe metadata might change.
     * Then we have to update the content
     * @private
     */
    UNSAFE_componentWillReceiveProps(newProps) {

        if (newProps.config !== this.props.config) {
            let config = this.fix_config(JSON.parse(JSON.stringify(newProps.config)));
            //let config = JSON.parse(JSON.stringify(this.fix_config(newProps.config)));

            this.update_config(config);
        }

        if (newProps.meta !== this.props.meta) {

            let new_meta = JSON.parse(JSON.stringify(newProps.meta));
            this.update_meta(new_meta);

        }



    }


    handleClose() {

        if (this.state.modal_close_timeout != undefined) {
            clearTimeout(this.state.modal_close_timeout);
        }
        this.setState({ showEditModal: false, modal_close_timeout: undefined });

    }


    render() {
        const { id } = this.props;
        const { meta, filter_meta_out, transform_meta_out, showEditModal, eventGraphId } = this.state;
        let { config,
            config_filter,
            config_transform,
            config_plot
        } = this.state;

        return (

            &lt;Accordion id={id} key={id} defaultActiveKey="plotter">

                {this.props.showFilter &amp;&amp; &lt;CustomAccordionItem title="Filter">
                    &lt; Filter
                        id={`${id}-filter`}
                        key={`${id}-filter`}
                        ref={this.filter_ref}
                        meta={meta}
                        config={config_filter}
                        setProps={
                            out => {
                                if ("config" in out) {
                                    //let new_config = { ...config };
                                    //new_config["filter"] = out.config;
                                    this.update_sub_config({ filter: out.config });
                                }

                                if ("meta_out" in out) {
                                    this.setState({ filter_meta_out: out.meta_out });
                                }
                            }}
                    />
                &lt;/CustomAccordionItem>}


                {this.props.showTransform &amp;&amp; &lt;CustomAccordionItem title="Transform">
                    &lt;Transform
                        id={`${id}-transform`}
                        key={`${id}-transform`}
                        ref={this.transform_ref}
                        meta={filter_meta_out}
                        config={config_transform}
                        setProps={
                            out => {
                                if ("config" in out) {
                                    //let new_config = { ...config };
                                    //new_config["transform"] = out.config;
                                    this.update_sub_config({ transform: out.config });
                                }

                                if ("meta_out" in out) {
                                    this.setState({ transform_meta_out: out.meta_out });
                                }
                            }}
                    />
                &lt;/CustomAccordionItem>}

                {this.props.showMetadata &amp;&amp; &lt;CustomAccordionItem title="Data Columns">
                    &lt;MetaCheck
                        id={`${id}-metacheck`}
                        key={`${id}-metacheck`}
                        meta={transform_meta_out}
                        setProps={out => { }}
                    />
                &lt;/CustomAccordionItem>}

                {this.props.showPlotter &amp;&amp; &lt;CustomAccordionItem title="Plotter" defaultOpen>
                    &lt;Plotter
                        id={`${id}-plotter`}
                        key={`${id}-plotter`}
                        meta={transform_meta_out}
                        config={config_plot}
                        setProps={
                            out => {
                                if ("config" in out) {
                                    //let new_config = { ...config };
                                    //new_config["plot"] = out.config;
                                    this.update_sub_config({ plot: out.config });
                                }
                            }}
                    />
                &lt;/CustomAccordionItem>}


                {this.props.showUpdate &amp;&amp; &lt;div className='accordion-item' key={`${id}-save-btn`}>
                    &lt;h2 className='accordion-header'>
                        &lt;ButtonGroup className='w-100 p-3'>
                            &lt;Button
                                onClick={e => { this.update_props(); }}
                                size="lg"
                                variant="outline-primary"
                            >New Plot&lt;/Button>
                            {/* enable update plot button only if available */}
                            {eventGraphId !== "" &amp;&amp; false &amp;&amp; &lt;Button
                                onClick={e => { this.update_props(eventGraphId); }}
                                size="lg"
                                variant="outline-primary"
                            >Update Plot&lt;/Button>}
                        &lt;/ButtonGroup>
                    &lt;/h2>
                &lt;/div>}

                {this.props.showParameterization &amp;&amp; &lt;CustomAccordionItem title="Parameterize" defaultOpen>
                    &lt;Parameterize
                        id={`${id}-parametrize`}
                        key={`${id}-parametrize`}
                        meta={transform_meta_out}
                        config={{ ...config }}
                        setProps={out => {
                            if ("config" in out) {
                                let new_config = { ...out.config };
                                new_config = JSON.parse(JSON.stringify(new_config));
                                config = new_config;
                                this.update_config(new_config);
                            }
                        }}
                    />
                &lt;/CustomAccordionItem>}

                {this.props.showStore &amp;&amp; &lt;CustomAccordionItem title="Store">
                    &lt;Localstore
                        id={`${id}-store`}
                        key={`${id}-store`}
                        meta={transform_meta_out}
                        config={config}
                        setProps={out => {
                            if ("config" in out) {
                                let new_config = { ...out.config }
                                this.update_config(new_config);
                            }
                        }}
                    />
                &lt;/CustomAccordionItem>}


                &lt;Modal
                    backdrop="static"
                    animation={false}
                    show={showEditModal}
                    onHide={() => this.handleClose()}>
                    &lt;Modal.Header closeButton>
                        &lt;Modal.Title>Load Plot Config&lt;/Modal.Title>
                    &lt;/Modal.Header>
                    &lt;Modal.Body>&lt;div style={{ minHeight: "15em" }} className="mb-3">

                        Do you want the load the plot configuration for this plot:
                        &lt;img src={this.state.eventThumbnail} alt="Plot Image" className='w-100' />

                        &lt;b>Note!&lt;/b> It will replace the current plot configuration.
                    &lt;/div>
                    &lt;/Modal.Body>
                    &lt;Modal.Footer>
                        &lt;Button variant="secondary" onClick={() => this.handleClose()}>
                            Close
                        &lt;/Button>
                        &lt;Button variant="primary" onClick={(e) => {

                            this.update_config(
                                this.state.eventConfig
                            );
                            //perhaps we want to do something with the eventGraphId
                            //to update the plot just for the right id?

                            this.handleClose();
                        }}>
                            Load
                        &lt;/Button>
                    &lt;/Modal.Footer>
                &lt;/Modal>


            &lt;/Accordion >






        );
    }
}

Configurator.defaultProps = {
    showFilter: true,
    showTransform: true,
    showPlotter: true,
    showMetadata: false,
    showParameterization: false,
    showStore: false,
    showUpdate: true
};

/**
 * @typedef
 * @public
 * @enum {}
 */
Configurator.propTypes = {
    /**
     * The ID used to identify this component in Dash callbacks.
     * @type {string}
     */
    id: PropTypes.string.isRequired,


    /**
     * The metadata the plotter selection is based on.
     * @type {Object}
     */
    meta: PropTypes.any.isRequired,

    /**
     * The resulting configuration of the plot.
     * @type {Object}
     */
    config: PropTypes.any,


    /**
     * The current configuration of the plot.
     * @type {Object}
     */
    currentConfig: PropTypes.any,


    /**
     * Prop to define the visibility of the Filter panel
     * @type {boolean}
     */
    showFilter: PropTypes.bool,

    /**
     * Prop to define the visibility of the Transform panel
     * @type {boolean}
     */
    showTransform: PropTypes.bool,

    /**
     * Prop to define the visibility of the Plot panel
     * @type {boolean}
     */
    showPlotter: PropTypes.bool,

    /**
     * Prop to define the visibility of the Metadata panel
     * @type {boolean}
     */
    showMetadata: PropTypes.bool,

    /**
     * Prop to define the visibility of the Parameterization panel
     * @type {boolean}
     */
    showParameterization: PropTypes.bool,

    /**
     * Prop to define the visibility of the Store panel
     * @type {boolean}
     */
    showStore: PropTypes.bool,

    /**
     * Prop to define the visibility of the update plot button
     * @type {boolean}
     */
    showUpdate: PropTypes.bool,

    /**
     * Dash-assigned callback that should be called to report property changes
     * to Dash, to make them available for callbacks.
     * @private
     */
    setProps: PropTypes.func



}


/**
 * @private
 */
export default Configurator;
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"ConfigReceiver","link":"<a href=\"ConfigReceiver.html\">ConfigReceiver</a>"},{"title":"Configurator","link":"<a href=\"Configurator.html\">Configurator</a>"},{"title":"Filter","link":"<a href=\"Filter.html\">Filter</a>"},{"title":"Graph","link":"<a href=\"Graph.html\">Graph</a>"},{"title":"MetaCheck","link":"<a href=\"MetaCheck.html\">MetaCheck</a>"},{"title":"Plotter","link":"<a href=\"Plotter.html\">Plotter</a>"},{"title":"Transform","link":"<a href=\"Transform.html\">Transform</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
